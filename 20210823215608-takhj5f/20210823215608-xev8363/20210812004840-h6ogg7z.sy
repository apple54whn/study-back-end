{
	"ID": "20210812004840-h6ogg7z",
	"Spec": "1",
	"Type": "NodeDocument",
	"Properties": {
		"id": "20210812004840-h6ogg7z",
		"scroll": "{\u0026quot;startId\u0026quot;:\u0026quot;20210731181519-hkjprh3\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20210801162726-ajcpjof\u0026quot;,\u0026quot;scrollTop\u0026quot;:295,\u0026quot;focusId\u0026quot;:\u0026quot;20210801162709-wqluzip\u0026quot;,\u0026quot;focusStart\u0026quot;:0,\u0026quot;focusEnd\u0026quot;:0}",
		"title": "偏向锁",
		"updated": "20210812005913"
	},
	"Children": [
		{
			"ID": "20210731181519-hkjprh3",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20210731181519-hkjprh3",
				"updated": "20210731181526"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "参考资料 🔥"
				}
			]
		},
		{
			"ID": "20210803004609-kyazqxb",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210803004609-kyazqxb",
				"updated": "20210803004616"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "http://link.zhihu.com/?target=https%3A//pdfs.semanticscholar.org/80b9/a87c62c352195c80553fa2c8bb87888164fc.pdf",
					"TextMarkTextContent": "Eliminating Synchronization-Related Atomic Operations with Biased Locking and Bulk Rebiasing"
				},
				{
					"Type": "NodeText",
					"Data": "，原始论文"
				}
			]
		},
		{
			"ID": "20210731181540-v6z81q8",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210731181540-v6z81q8",
				"updated": "20210801123944"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "http://www.diva-portal.org/smash/get/diva2:754541/FULLTEXT01.pdf",
					"TextMarkTextContent": "Evaluating and improving biased locking in the HotSpot virtual machine"
				},
				{
					"Type": "NodeText",
					"Data": "，参考 chapter 3"
				}
			]
		},
		{
			"ID": "20210803004451-ekwzq2o",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210803004451-ekwzq2o",
				"updated": "20210804214834"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://www.cnblogs.com/LemonFive/p/11248248.html",
					"TextMarkTextContent": "偏向锁批量重偏向与批量撤销"
				},
				{
					"Type": "NodeText",
					"Data": " 有实验代码"
				}
			]
		},
		{
			"ID": "20210804214815-o3z7nh8",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210804214815-o3z7nh8",
				"updated": "20210807175846"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://github.com/farmerjohngit/myblog/issues/13",
					"TextMarkTextContent": "死磕Synchronized底层实现--偏向锁"
				},
				{
					"Type": "NodeText",
					"Data": " 🔥 这个系列太详细了，跪了"
				}
			]
		},
		{
			"ID": "20210812002705-dux1q8p",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210812002705-dux1q8p",
				"updated": "20210812002741"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "a",
					"TextMarkAHref": "https://blog.csdn.net/qq_31865983/article/details/105024397",
					"TextMarkTextContent": "Hotspot 三种锁实现总结"
				},
				{
					"Type": "NodeText",
					"Data": " 🔥 这个也非常🐮"
				}
			]
		},
		{
			"ID": "20210801162709-wqluzip",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210801162709-wqluzip",
				"updated": "20210801162709"
			}
		},
		{
			"ID": "20210804214952-7x1bu8r",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20210804214952-7x1bu8r",
				"updated": "20210804215452"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "偏向锁的引入的原因 🔥"
				}
			]
		},
		{
			"ID": "20210731173252-bssrsdv",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20210731173252-bssrsdv",
				"updated": "20210731173510"
			},
			"Children": [
				{
					"ID": "20210731173303-ezaprod",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210731173303-ezaprod"
					},
					"Children": [
						{
							"ID": "20210731173303-m3flsxe",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210731173303-m3flsxe",
								"updated": "20210804215735"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "多数情况下， "
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "锁总是由同一个线程获得"
								},
								{
									"Type": "NodeText",
									"Data": " 。但是轻量级锁每次"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "加锁、解锁时都需要进行CAS操作"
								},
								{
									"Type": "NodeText",
									"Data": "（将mark word CAS 到 lock record 中的 displaced mark word）；重量级锁更是需要进行"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "内核态的系统调用"
								},
								{
									"Type": "NodeText",
									"Data": "，资源耗费大"
								}
							]
						},
						{
							"ID": "20210804215210-m911kf7",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210804215210-m911kf7"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "所以 Java 6 中引入了偏向锁（需开启偏向锁）来做优化（减少了轻量级锁的 CAS 操作）"
								}
							]
						}
					]
				},
				{
					"ID": "20210731173305-zfwdfi8",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210731173305-zfwdfi8",
						"updated": "20210731173510"
					},
					"Children": [
						{
							"ID": "20210731173305-7uagm36",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210731173305-7uagm36",
								"updated": "20210731173510"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "但是一旦"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "遇到竞争"
								},
								{
									"Type": "NodeText",
									"Data": "，需要对偏向锁进行"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "撤销（revoke）操作，性能开销大"
								},
								{
									"Type": "NodeText",
									"Data": "。所以 Java 15 取消并禁用了偏向锁。"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20210803233851-xvsn1zw",
			"Type": "NodeSuperBlock",
			"Properties": {
				"fold": "1",
				"id": "20210803233851-xvsn1zw",
				"updated": "20210809231306"
			},
			"Children": [
				{
					"Type": "NodeSuperBlockOpenMarker"
				},
				{
					"Type": "NodeSuperBlockLayoutMarker",
					"Data": "row"
				},
				{
					"ID": "20210707224540-7jod1ja",
					"Type": "NodeParagraph",
					"Properties": {
						"id": "20210707224540-7jod1ja",
						"updated": "20210807180057"
					},
					"Children": [
						{
							"Type": "NodeText",
							"Data": "偏向锁、轻量级锁对比："
						}
					]
				},
				{
					"ID": "20210707224540-ck92t0z",
					"Type": "NodeCodeBlock",
					"IsFencedCodeBlock": true,
					"Properties": {
						"fold": "0",
						"id": "20210707224540-ck92t0z",
						"updated": "20210707224540"
					},
					"Children": [
						{
							"Type": "NodeCodeBlockFenceOpenMarker",
							"Data": "```"
						},
						{
							"Type": "NodeCodeBlockFenceInfoMarker",
							"CodeBlockInfo": "amF2YQ=="
						},
						{
							"Type": "NodeCodeBlockCode",
							"Data": "public class Test {\n    static final Object obj = new Object();\n    public static void m1() {\n        synchronized( obj ) {\n            // 同步块 A\n            m2();\n        }\n    }\n    public static void m2() {\n        synchronized( obj ) {\n            // 同步块 B\n            m3();\n        }\n    }\n    public static void m3() {\n        synchronized( obj ) {\n        }\n        // 同步块 C\n    }\n}\n"
						},
						{
							"Type": "NodeCodeBlockFenceCloseMarker",
							"Data": "```"
						}
					]
				},
				{
					"ID": "20210803233750-y16amnf",
					"Type": "NodeSuperBlock",
					"Properties": {
						"id": "20210803233750-y16amnf"
					},
					"Children": [
						{
							"Type": "NodeSuperBlockOpenMarker"
						},
						{
							"Type": "NodeSuperBlockLayoutMarker",
							"Data": "col"
						},
						{
							"ID": "20210707224540-g0c6t0x",
							"Type": "NodeCodeBlock",
							"IsFencedCodeBlock": true,
							"Properties": {
								"id": "20210707224540-g0c6t0x",
								"style": "text-align: center; width: 50%; flex: 0 0 auto;",
								"updated": "20210807175424"
							},
							"Children": [
								{
									"Type": "NodeCodeBlockFenceOpenMarker",
									"Data": "```"
								},
								{
									"Type": "NodeCodeBlockFenceInfoMarker",
									"CodeBlockInfo": "bWVybWFpZA=="
								},
								{
									"Type": "NodeCodeBlockCode",
									"Data": "flowchart TB\n    subgraph 偏向锁\n    m1(\"m1内调用synchronized(obj)\")\n    m1-- 用 ThreadId 替换  Mark Word --\u003eobj(锁对象)\n    m2(\"m2内调用synchronized(obj)\")\n    m2-- 检查 ThreadId 是否是自己 --\u003eobj(锁对象)\n    m3(\"m3内调用synchronized(obj)\")\n    m3-- 检查 ThreadId 是否是自己 --\u003eobj(锁对象)\n   \tend"
								},
								{
									"Type": "NodeCodeBlockFenceCloseMarker",
									"Data": "```"
								}
							]
						},
						{
							"ID": "20210803233717-eeprqbk",
							"Type": "NodeCodeBlock",
							"IsFencedCodeBlock": true,
							"Properties": {
								"id": "20210803233717-eeprqbk",
								"updated": "20210807175443"
							},
							"Children": [
								{
									"Type": "NodeCodeBlockFenceOpenMarker",
									"Data": "```"
								},
								{
									"Type": "NodeCodeBlockFenceInfoMarker",
									"CodeBlockInfo": "bWVybWFpZA=="
								},
								{
									"Type": "NodeCodeBlockCode",
									"Data": "flowchart TB\n    subgraph 轻量级锁\n    m1(\"m1内调用synchronized(obj)\") -.生成锁记录.-\u003e m1\n    m1-- 用 锁记录 替换 Mark Word --\u003eobj(锁对象)\n    m2(\"m2内调用synchronized(obj)\") -.生成锁记录.-\u003e m2\n    m2-- 用 锁记录 替换 Mark Word --\u003eobj(锁对象)\n    m3(\"m3内调用synchronized(obj)\") -.生成锁记录.-\u003e m3\n    m3-- 用 锁记录 替换 Mark Word --\u003eobj(锁对象)\n   \tend"
								},
								{
									"Type": "NodeCodeBlockFenceCloseMarker",
									"Data": "```"
								}
							]
						},
						{
							"Type": "NodeSuperBlockCloseMarker"
						}
					]
				},
				{
					"Type": "NodeSuperBlockCloseMarker"
				}
			]
		},
		{
			"ID": "20210804230702-uzselr2",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210804230702-uzselr2",
				"updated": "20210804230702"
			}
		},
		{
			"ID": "20210707224540-xgpuj6b",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20210707224540-xgpuj6b",
				"updated": "20210804230752"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "偏向锁介绍 🔥"
				}
			]
		},
		{
			"ID": "20210801163519-8avr491",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20210801163519-8avr491",
				"style": "border-radius: 4px; transition: all 0.15s cubic-bezier(0, 0, 0.2, 1) 0ms; background-color: var(--b3-theme-primary-lightest); box-shadow: 4px 0px 0 var(--b3-theme-primary-lightest), -4px 0px 0 var(--b3-theme-primary-lightest);",
				"updated": "20210804000110"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "特点 🔥"
				}
			]
		},
		{
			"ID": "20210707224540-bo9iazx",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-bo9iazx",
				"updated": "20210808175806"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "任何一个对象都可以成为锁对象"
				},
				{
					"Type": "NodeText",
					"Data": "："
				}
			]
		},
		{
			"ID": "20210707224540-aaj9qmm",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20210707224540-aaj9qmm",
				"updated": "20210810220101"
			},
			"Children": [
				{
					"ID": "20210707224540-qurigxr",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210707224540-qurigxr",
						"updated": "20210808175816"
					},
					"Children": [
						{
							"ID": "20210707224540-fmcvgn8",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210707224540-fmcvgn8",
								"updated": "20210808175816"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "一个"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "对象创建"
								},
								{
									"Type": "NodeText",
									"Data": "时，如果开启了偏向锁（默认开启），那么"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "对象创建后，markword 值为 0x05 即最后 3 位为 101"
								},
								{
									"Type": "NodeText",
									"Data": "，这时它的 thread、epoch、age 都为 0，加锁时才会改变。此时称作"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "匿名偏向"
								}
							]
						}
					]
				},
				{
					"ID": "20210707224540-1ed9n37",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210707224540-1ed9n37",
						"updated": "20210808175830"
					},
					"Children": [
						{
							"ID": "20210707224540-s4m89jn",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210707224540-s4m89jn",
								"updated": "20210808175830"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "但是"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "偏向锁是默认是延迟的"
								},
								{
									"Type": "NodeText",
									"Data": "，4s左右，导致其不会在程序启动时立即生效，如果想避免延迟，可以加 VM 参数"
								}
							]
						},
						{
							"ID": "20210707224540-irsya5x",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210707224540-irsya5x",
								"updated": "20210729005519"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "-XX:BiasedLockingStartupDelay=0"
								},
								{
									"Type": "NodeText",
									"Data": " 来禁用延迟。"
								}
							]
						},
						{
							"ID": "20210729004954-w1efieo",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210729004954-w1efieo",
								"updated": "20210729005059"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "原因在于JVM刚启动时有大量的线程去竞争锁，使用偏向锁只会降低效率"
								}
							]
						},
						{
							"ID": "20210729005521-apr1nto",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210729005521-apr1nto",
								"updated": "20210805215615"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "可使用如下命令查看有关JVM"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "非标（非标准）参数"
								},
								{
									"Type": "NodeText",
									"Data": "："
								}
							]
						},
						{
							"ID": "20210729005523-1u0v4la",
							"Type": "NodeCodeBlock",
							"IsFencedCodeBlock": true,
							"Properties": {
								"id": "20210729005523-1u0v4la",
								"updated": "20210729005702"
							},
							"Children": [
								{
									"Type": "NodeCodeBlockFenceOpenMarker",
									"Data": "```"
								},
								{
									"Type": "NodeCodeBlockFenceInfoMarker",
									"CodeBlockInfo": "YmFzaA=="
								},
								{
									"Type": "NodeCodeBlockCode",
									"Data": "java -XX:+PrintFlagsFinal -version | grep BiasedLocking\n\n     intx BiasedLockingBulkRebiasThreshold          = 20                                  {product}\n     intx BiasedLockingBulkRevokeThreshold          = 40                                  {product}\n     intx BiasedLockingDecayTime                    = 25000                               {product}\n     intx BiasedLockingStartupDelay                 = 4000                                {product}\n     bool TraceBiasedLocking                        = false                               {product}\n     bool UseBiasedLocking                          = true                                {product}\nopenjdk version \"1.8.0_232\"\nOpenJDK Runtime Environment (AdoptOpenJDK)(build 1.8.0_232-b09)\nOpenJDK 64-Bit Server VM (AdoptOpenJDK)(build 25.232-b09, mixed mode)\n"
								},
								{
									"Type": "NodeCodeBlockFenceCloseMarker",
									"Data": "```"
								}
							]
						}
					]
				},
				{
					"ID": "20210707224540-hdy5r2u",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210707224540-hdy5r2u"
					},
					"Children": [
						{
							"ID": "20210707224540-h6wowzb",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210707224540-h6wowzb",
								"updated": "20210729001437"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "如果"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "没有开启偏向锁"
								},
								{
									"Type": "NodeText",
									"Data": "，那么对象创建后，Mark Word 值为 0x01 即最后 3 位为 "
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "001（无锁）"
								},
								{
									"Type": "NodeText",
									"Data": "，这时它的 hashcode、age 都为 0，第一次用到 hashcode 时才会赋值"
								}
							]
						}
					]
				},
				{
					"ID": "20210803235857-v2cq38b",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210803235857-v2cq38b",
						"updated": "20210810220101"
					},
					"Children": [
						{
							"ID": "20210803235857-o26l1q4",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210803235857-o26l1q4",
								"updated": "20210810220101"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "biased 后是线程 id（OS 分配的，和 Java 不一样）。只有第一次加锁后才有。处于"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "偏向锁的对象释放锁（解锁）后，线程 id 仍存储于对象头中"
								},
								{
									"Type": "NodeText",
									"Data": "，除非"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "撤销偏向锁"
								},
								{
									"Type": "NodeText",
									"Data": "。"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "释放偏向锁仅仅将锁记录中 obj 置为 null 即可"
								}
							]
						}
					]
				},
				{
					"ID": "20210804001923-plnrk9m",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210804001923-plnrk9m",
						"updated": "20210808175921"
					},
					"Children": [
						{
							"ID": "20210804001923-h33tl8f",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210804001923-h33tl8f",
								"updated": "20210808175921"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "除了偏向锁其他锁执行完释放锁（解锁）后都是"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong code",
									"TextMarkTextContent": "0x1"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "无锁状态"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20210807180330-46rnzvl",
			"Type": "NodeBlockQueryEmbed",
			"Properties": {
				"id": "20210807180330-46rnzvl",
				"updated": "20210807180330"
			},
			"Children": [
				{
					"Type": "NodeOpenBrace"
				},
				{
					"Type": "NodeOpenBrace"
				},
				{
					"Type": "NodeBlockQueryEmbedScript",
					"Data": "select * from blocks where id='20210729001616-niy4pug'"
				},
				{
					"Type": "NodeCloseBrace"
				},
				{
					"Type": "NodeCloseBrace"
				}
			]
		},
		{
			"ID": "20210807180329-p4r8xl2",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210807180329-p4r8xl2",
				"updated": "20210807180329"
			}
		},
		{
			"ID": "20210801162902-v42rrx6",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210801162902-v42rrx6",
				"updated": "20210801162902"
			}
		},
		{
			"ID": "20210707224540-hvuhfyq",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20210707224540-hvuhfyq",
				"updated": "20210728235924"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "测试延迟性"
				}
			]
		},
		{
			"ID": "20210707224540-ejdiqvu",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210707224540-ejdiqvu",
				"updated": "20210707224540"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YQ=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "@Slf4j(topic = \"TestBiasedLock\")\npublic class TestBiasedLock {\n\n    public static void main(String[] args) throws InterruptedException {\n        test1();\n    }\n\n    /**\n     * 测试101\n     */\n    private static void test1(){\n        log.debug(ClassLayout.parseInstance(new Dog()).toPrintable());\n\n        // 偏向锁是默认是延迟的，不会在程序启动时立即生效。VM参数可以解决-XX:BiasedLockingStartupDelay=0\n        // 或睡一会。TimeUnit.SECONDS.sleep(5);\n        log.debug(ClassLayout.parseInstance(new Dog()).toPrintable());\n    }\n}\n\nclass Dog {\n\n}\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210707224540-e0yey13",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-e0yey13",
				"updated": "20210803235035"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "结果如下"
				}
			]
		},
		{
			"ID": "20210707224540-vxkwbfm",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210707224540-vxkwbfm",
				"updated": "20210803235015"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "23:47:03.277 [main] DEBUG TestBiasedLock - _999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000005 (biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210801163439-6qycz33",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210801163439-6qycz33",
				"updated": "20210803232652"
			}
		},
		{
			"ID": "20210803232618-uiq3jda",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210803232618-uiq3jda",
				"updated": "20210803232618"
			}
		},
		{
			"ID": "20210801162721-jyk4bq3",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20210801162721-jyk4bq3",
				"updated": "20210810220113"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "关闭偏向锁开关"
				}
			]
		},
		{
			"ID": "20210801162408-l1y8qp1",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210801162408-l1y8qp1",
				"updated": "20210801162440"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "添加 VM 参数 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "-XX:-UseBiasedLocking"
				},
				{
					"Type": "NodeText",
					"Data": " "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "禁用偏向锁"
				},
				{
					"Type": "NodeText",
					"Data": "。变量前是 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "-"
				},
				{
					"Type": "NodeText",
					"Data": " 为关闭，若是"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "+"
				},
				{
					"Type": "NodeText",
					"Data": "则开启"
				}
			]
		},
		{
			"ID": "20210801163623-m4tqm3t",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210801163623-m4tqm3t",
				"updated": "20210801163631"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YQ=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "@Slf4j(topic = \"TestBiasedLock\")\npublic class TestBiasedLock {\n\n    public static void main(String[] args) throws InterruptedException {\n        test2();\n    }\n\n    private static void test2() {\n        Dog d = new Dog();\n        ClassLayout classLayout = ClassLayout.parseInstance(d);\n        new Thread(() -\u003e {\n            log.debug(\"synchronized 加锁前\\n{}\", classLayout.toPrintable());\n            synchronized (d) {\n                log.debug(\"synchronized 加锁中\\n{}\", classLayout.toPrintable());\n            }\n            log.debug(\"synchronized 加锁后\\n{}\",classLayout.toPrintable());\n        }, \"t1\").start();\n    }\n}\n\nclass Dog {\n\n}"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210707224540-rw5kbke",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-rw5kbke",
				"updated": "20210728004030"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "结果如下（"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "小端法"
				},
				{
					"Type": "NodeText",
					"Data": "）："
				}
			]
		},
		{
			"ID": "20210707224540-wh60epk",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210707224540-wh60epk",
				"updated": "20210803235639"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "23:56:10.023 [t1] DEBUG TestBiasedLock - synchronized 加锁前\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n23:56:10.028 [t1] DEBUG TestBiasedLock - synchronized 加锁中\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x000070000b9a5900 (thin lock: 0x000070000b9a5900)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n23:56:10.029 [t1] DEBUG TestBiasedLock - synchronized 加锁后\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210801162726-ajcpjof",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210801162726-ajcpjof",
				"updated": "20210804002019"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "加锁前、后为"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "0x1"
				},
				{
					"Type": "NodeText",
					"Data": "即无锁，加锁中为"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "0x0"
				},
				{
					"Type": "NodeText",
					"Data": "即轻量锁。"
				}
			]
		},
		{
			"ID": "20210804002045-u9t704f",
			"Type": "NodeBlockQueryEmbed",
			"Properties": {
				"id": "20210804002045-u9t704f",
				"updated": "20210804002045"
			},
			"Children": [
				{
					"Type": "NodeOpenBrace"
				},
				{
					"Type": "NodeOpenBrace"
				},
				{
					"Type": "NodeBlockQueryEmbedScript",
					"Data": "select * from blocks where id='20210804001923-h33tl8f'"
				},
				{
					"Type": "NodeCloseBrace"
				},
				{
					"Type": "NodeCloseBrace"
				}
			]
		},
		{
			"ID": "20210801162906-gikxgi4",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210801162906-gikxgi4",
				"updated": "20210801162906"
			}
		},
		{
			"ID": "20210801162825-qa42wb8",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210801162825-qa42wb8",
				"updated": "20210801162825"
			}
		},
		{
			"ID": "20210811224916-jqtarw5",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20210811224916-jqtarw5",
				"updated": "20210812005237"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "加锁—源码分析、总结 🔥"
				}
			]
		},
		{
			"ID": "20210811225049-fw29gtg",
			"Type": "NodeBlockquote",
			"Properties": {
				"id": "20210811225049-fw29gtg",
				"updated": "20210811225830"
			},
			"Children": [
				{
					"Type": "NodeBlockquoteMarker",
					"Data": "\u003e"
				},
				{
					"ID": "20210811225101-stq98oo",
					"Type": "NodeParagraph",
					"Properties": {
						"id": "20210811225101-stq98oo",
						"updated": "20210811225104"
					},
					"Children": [
						{
							"Type": "NodeText",
							"Data": "注意："
						}
					]
				},
				{
					"ID": "20210811225106-jbpwjea",
					"Type": "NodeList",
					"ListData": {},
					"Properties": {
						"id": "20210811225106-jbpwjea",
						"updated": "20210811225830"
					},
					"Children": [
						{
							"ID": "20210811225108-ae9ltgg",
							"Type": "NodeListItem",
							"ListData": {
								"BulletChar": 42,
								"Marker": "Kg=="
							},
							"Properties": {
								"id": "20210811225108-ae9ltgg"
							},
							"Children": [
								{
									"ID": "20210811225108-i9cmvnf",
									"Type": "NodeParagraph",
									"Properties": {
										"id": "20210811225108-i9cmvnf",
										"updated": "20210811225212"
									},
									"Children": [
										{
											"Type": "NodeText",
											"Data": "synchronized方法和代码块的源码不一样，但是逻辑都是一样的。此处使用"
										},
										{
											"Type": "NodeTextMark",
											"TextMarkType": "strong",
											"TextMarkTextContent": "代码块的源码"
										}
									]
								}
							]
						},
						{
							"ID": "20210811225213-ger7xu1",
							"Type": "NodeListItem",
							"ListData": {
								"BulletChar": 42,
								"Marker": "Kg=="
							},
							"Properties": {
								"id": "20210811225213-ger7xu1"
							},
							"Children": [
								{
									"ID": "20210811225213-sdsjmuf",
									"Type": "NodeParagraph",
									"Properties": {
										"id": "20210811225213-sdsjmuf",
										"updated": "20210811225603"
									},
									"Children": [
										{
											"Type": "NodeText",
											"Data": "HotSpot实现synchronized有2处，一处在"
										},
										{
											"Type": "NodeTextMark",
											"TextMarkType": "a",
											"TextMarkAHref": "http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/9ce27f0a4683/src/share/vm/interpreter/bytecodeInterpreter.cpp#l1816",
											"TextMarkTextContent": "bytecodeInterpreter.cpp#1816"
										},
										{
											"Type": "NodeText",
											"Data": "，一处在"
										},
										{
											"Type": "NodeTextMark",
											"TextMarkType": "a",
											"TextMarkAHref": "http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/9ce27f0a4683/src/cpu/x86/vm/templateTable_x86_64.cpp#l3667",
											"TextMarkTextContent": "templateTable_x86_64.cpp#3667"
										},
										{
											"Type": "NodeText",
											"Data": "。前者是JVM的"
										},
										{
											"Type": "NodeTextMark",
											"TextMarkType": "strong",
											"TextMarkTextContent": "字节码解释器"
										},
										{
											"Type": "NodeText",
											"Data": "，使用C++实现的每一条JVM指令，解释执行所以比较慢；后者是JVM的"
										},
										{
											"Type": "NodeTextMark",
											"TextMarkType": "strong",
											"TextMarkTextContent": "模板解释器"
										},
										{
											"Type": "NodeText",
											"Data": "，对每一条JVM都写了对应的汇编码，效率高！模板解释器可以看这篇"
										},
										{
											"Type": "NodeTextMark",
											"TextMarkType": "a",
											"TextMarkAHref": "https://zhuanlan.zhihu.com/p/33886967",
											"TextMarkTextContent": "文章"
										}
									]
								}
							]
						},
						{
							"ID": "20210811225625-1or4idm",
							"Type": "NodeListItem",
							"ListData": {
								"BulletChar": 42,
								"Marker": "Kg=="
							},
							"Properties": {
								"id": "20210811225625-1or4idm",
								"updated": "20210811225830"
							},
							"Children": [
								{
									"ID": "20210811225625-bus171e",
									"Type": "NodeParagraph",
									"Properties": {
										"id": "20210811225625-bus171e",
										"updated": "20210811225830"
									},
									"Children": [
										{
											"Type": "NodeText",
											"Data": "synchronized字节码解释器加锁在"
										},
										{
											"Type": "NodeTextMark",
											"TextMarkType": "a",
											"TextMarkAHref": "http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/9ce27f0a4683/src/cpu/x86/vm/templateTable_x86_64.cpp#l3667",
											"TextMarkTextContent": "bytecodeInterpreter.cpp#1816"
										},
										{
											"Type": "NodeText",
											"Data": "，解锁在"
										},
										{
											"Type": "NodeTextMark",
											"TextMarkType": "a",
											"TextMarkAHref": "http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/9ce27f0a4683/src/share/vm/interpreter/bytecodeInterpreter.cpp#l1923",
											"TextMarkTextContent": "bytecodeInterpreter.cpp#1923"
										},
										{
											"Type": "NodeText",
											"Data": "。对应的模板解释器加锁在"
										},
										{
											"Type": "NodeTextMark",
											"TextMarkType": "a",
											"TextMarkAHref": "http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/9ce27f0a4683/src/cpu/x86/vm/templateTable_x86_64.cpp#l3667",
											"TextMarkTextContent": "templateTable_x86_64.cpp#3667"
										}
									]
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20210812004704-18gdhra",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210812004704-18gdhra",
				"updated": "20210812004704"
			}
		},
		{
			"ID": "20210812004704-li9y3vp",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210812004704-li9y3vp",
				"updated": "20210812004704"
			}
		},
		{
			"ID": "20210812005344-lpg33rb",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20210812005344-lpg33rb",
				"updated": "20210812005412"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "BasicObjectLock \u0026 BasicLock"
				}
			]
		},
		{
			"ID": "20210812005435-ybk05tp",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210812005435-ybk05tp",
				"updated": "20210812005537"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "hotspot/src/share/vm/runtime/basicLock.hpp 非完整版源码！"
				}
			]
		},
		{
			"ID": "20210812004657-y6iwgbt",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210812004657-y6iwgbt",
				"updated": "20210812005519"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "Yysr"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "class BasicLock VALUE_OBJ_CLASS_SPEC {\n  friend class VMStructs;\n private:\n  volatile markOop _displaced_header;\n public:\n  markOop      displaced_header() const               { return _displaced_header; }\n  void         set_displaced_header(markOop header)   { _displaced_header = header; }\n};\n\nclass BasicObjectLock VALUE_OBJ_CLASS_SPEC {\n  friend class VMStructs;\n private:\n  BasicLock _lock;                                    // the lock, must be double word aligned\n  oop       _obj;                                     // object holds the lock;\n\n public:\n  // Manipulation\n  oop      obj() const                                { return _obj;  }\n  void set_obj(oop obj)                               { _obj = obj; }\n  BasicLock* lock()                                   { return \u0026_lock; }\n};\n\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210812004616-1y7tzxi",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20210812004616-1y7tzxi",
				"updated": "20210812005913"
			},
			"Children": [
				{
					"ID": "20210812005545-hgb0my1",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210812005545-hgb0my1"
					},
					"Children": [
						{
							"ID": "20210812005545-aj56jjd",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210812005545-aj56jjd",
								"updated": "20210812005619"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "BasicObjectLock"
								},
								{
									"Type": "NodeText",
									"Data": "包含"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "BasicLock"
								}
							]
						}
					]
				},
				{
					"ID": "20210812005619-njyc5yy",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210812005619-njyc5yy",
						"updated": "20210812005857"
					},
					"Children": [
						{
							"ID": "20210812005619-njh16pi",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210812005619-njh16pi",
								"updated": "20210812005857"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "BasicLock _lock"
								},
								{
									"Type": "NodeText",
									"Data": "用于存储"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "锁对象头信息"
								},
								{
									"Type": "NodeText",
									"Data": "，实现轻量级锁"
								}
							]
						}
					]
				},
				{
					"ID": "20210812005748-bpd4a53",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210812005748-bpd4a53",
						"updated": "20210812005913"
					},
					"Children": [
						{
							"ID": "20210812005748-bbq4oc6",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210812005748-bbq4oc6",
								"updated": "20210812005913"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "code",
									"TextMarkTextContent": "oop       _obj"
								},
								{
									"Type": "NodeText",
									"Data": "用于存储关联的"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "锁对象"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20210812005457-ggxx1o6",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210812005457-ggxx1o6",
				"updated": "20210812005457"
			}
		},
		{
			"ID": "20210803233710-dcb9se8",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210803233710-dcb9se8",
				"updated": "20210809212612"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "源码：hotspot/src/share/vm/interpreter/bytecodeInterpreter.cpp 的 _monitorenter"
				}
			]
		},
		{
			"ID": "20210807180010-5gel2y1",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210807180010-5gel2y1",
				"updated": "20210810215046"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "Yysr"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "/* monitorenter and monitorexit for locking/unlocking an object */\n// monitorenter and monitorexit 加锁、解锁流程\nCASE(_monitorenter): {\n  // lockee即锁对象\n  oop lockee = STACK_OBJECT(-1);\n  // derefing's lockee ought to provoke implicit null check\n  CHECK_NULL(lockee);\n  // find a free monitor or one already allocated for this object\n  // if we find a matching object then we need a new monitor\n  // since this is recursive enter\n  // 找一个 lock record 空闲的锁记录（其object ref为null）\n  // 按内存地址从低往高找到最后一个可用的Lock Record，即找到内存地址最高的可用Lock Record\n  BasicObjectLock* limit = istate-\u003emonitor_base();\n  BasicObjectLock* most_recent = (BasicObjectLock*) istate-\u003estack_base();\n  BasicObjectLock* entry = NULL;\n  while (most_recent != limit ) {\n    if (most_recent-\u003eobj() == NULL) entry = most_recent;\n    else if (most_recent-\u003eobj() == lockee) break;\n    most_recent++;\n  }\n  if (entry != NULL) {\n    // 锁记录的obj_ref指向锁对象\n    entry-\u003eset_obj(lockee);\n    int success = false;\n    uintptr_t epoch_mask_in_place = (uintptr_t)markOopDesc::epoch_mask_in_place;\n\n    markOop mark = lockee-\u003emark();\n    intptr_t hash = (intptr_t) markOopDesc::no_hash;\n    // implies UseBiasedLocking\n    // 锁对象的 markword 中开启偏向锁\n    if (mark-\u003ehas_bias_pattern()) {\n      uintptr_t thread_ident;\n      uintptr_t anticipated_bias_locking_value;\n      thread_ident = (uintptr_t)istate-\u003ethread();\n      anticipated_bias_locking_value =\n              (((uintptr_t)lockee-\u003eklass()-\u003eprototype_header() | thread_ident) ^ (uintptr_t)mark) \u0026\n              ~((uintptr_t) markOopDesc::age_mask_in_place);\n\n      if  (anticipated_bias_locking_value == 0) {\n        // 已偏向当前线程\n        // already biased towards this thread, nothing to do\n        if (PrintBiasedLockingStatistics) {\n          (* BiasedLocking::biased_lock_entry_count_addr())++;\n        }\n        success = true;\n      }\n      else if ((anticipated_bias_locking_value \u0026 markOopDesc::biased_lock_mask_in_place) != 0) {\n        // try revoke bias\n        markOop header = lockee-\u003eklass()-\u003eprototype_header();\n        if (hash != markOopDesc::no_hash) {\n          header = header-\u003ecopy_set_hash(hash);\n        }\n        if (Atomic::cmpxchg_ptr(header, lockee-\u003emark_addr(), mark) == mark) {\n          if (PrintBiasedLockingStatistics)\n            (*BiasedLocking::revoked_lock_entry_count_addr())++;\n        }\n      }\n      else if ((anticipated_bias_locking_value \u0026 epoch_mask_in_place) !=0) {\n        // try rebias\n        markOop new_header = (markOop) ( (intptr_t) lockee-\u003eklass()-\u003eprototype_header() | thread_ident);\n        if (hash != markOopDesc::no_hash) {\n          new_header = new_header-\u003ecopy_set_hash(hash);\n        }\n        if (Atomic::cmpxchg_ptr((void*)new_header, lockee-\u003emark_addr(), mark) == mark) {\n          if (PrintBiasedLockingStatistics)\n            (* BiasedLocking::rebiased_lock_entry_count_addr())++;\n        }\n        else {\n          CALL_VM(InterpreterRuntime::monitorenter(THREAD, entry), handle_exception);\n        }\n        success = true;\n      }\n      else {\n        // try to bias towards thread in case object is anonymously biased\n        markOop header = (markOop) ((uintptr_t) mark \u0026 ((uintptr_t)markOopDesc::biased_lock_mask_in_place |\n                (uintptr_t)markOopDesc::age_mask_in_place |\n                epoch_mask_in_place));\n        if (hash != markOopDesc::no_hash) {\n          header = header-\u003ecopy_set_hash(hash);\n        }\n        markOop new_header = (markOop) ((uintptr_t) header | thread_ident);\n        // debugging hint\n        DEBUG_ONLY(entry-\u003elock()-\u003eset_displaced_header((markOop) (uintptr_t) 0xdeaddead);)\n        if (Atomic::cmpxchg_ptr((void*)new_header, lockee-\u003emark_addr(), header) == header) {\n          if (PrintBiasedLockingStatistics)\n            (* BiasedLocking::anonymously_biased_lock_entry_count_addr())++;\n        }\n        else {\n          CALL_VM(InterpreterRuntime::monitorenter(THREAD, entry), handle_exception);\n        }\n        success = true;\n      }\n    }\n\n    // 第一次，锁对象为无锁状态，记录hashcode、001等\n    // 构造的锁记录以及其displaced markword和上面一模一样的\n    // 线程进行CAS：entry为锁记录地址值，交换到锁对象的markword\n    // CAS的期望值就是displaced，所以必定会CAS成功\n\n    // 第二个线程进来，第一个还未执行完毕\n    // 此时锁对象为轻量级锁\n\n\n\n    // 这里已经是轻量级锁流程了\n    // traditional lightweight locking\n    if (!success) {\n      // 利用锁对象的mark word，构造一个无锁的markword，称作displaced mark word。这是个新的对象！！！\n      markOop displaced = lockee-\u003emark()-\u003eset_unlocked();\n      // entry-\u003eset_obj(lockee);代码已经将锁记录的obj指向了锁对象！！！至此，锁记录2个参数已经赋值完毕！！！\n      entry-\u003elock()-\u003eset_displaced_header(displaced);\n      bool call_vm = UseHeavyMonitors;\n      // 利用CAS将锁对象Mark Word中的锁记录地址替换为上述锁记录的地址\n      // 只有锁对象为无锁状态才能CAS成功，否则代表锁对象已经被线程使用了。所以上面构造一个无锁markword也就理解了\n      // CAS中，希望锁对象的锁记录值为新构造的无锁displaced，但是对于竞争线程来说，锁对象的markword还是轻量级锁000，所以无法CAS成功\n      // 只有锁对象为无锁时，才能和由锁对象构造的markword一致，才能CAS成功\n\n      // Atomic::cmpxchg_ptr 返回每次CAS后的当前值（无论成功失败）\n      // entry 是 BasicObjectLock的指针，由于数据对齐，假设处理器总是从内存中取8个字节，则地址必须为8的倍数。这里后3位应该就是000（或2位00）即轻量级锁\n      if (call_vm || Atomic::cmpxchg_ptr(entry, lockee-\u003emark_addr(), displaced) != displaced) {\n        // Is it simple recursive case? 可重入？\n        if (!call_vm \u0026\u0026 THREAD-\u003eis_lock_owned((address) displaced-\u003eclear_lock_bits())) {\n          entry-\u003elock()-\u003eset_displaced_header(NULL);\n        } else {\n          CALL_VM(InterpreterRuntime::monitorenter(THREAD, entry), handle_exception);\n        }\n      }\n    }\n    UPDATE_PC_AND_TOS_AND_CONTINUE(1, -1);\n  } else {\n    istate-\u003eset_msg(more_monitors);\n    UPDATE_PC_AND_RETURN(0); // Re-execute\n  }\n}"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210811225029-eufwtbo",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210811225029-eufwtbo",
				"updated": "20210811225029"
			}
		},
		{
			"ID": "20210812005303-qgb2orh",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210812005303-qgb2orh",
				"updated": "20210812005303"
			}
		},
		{
			"ID": "20210812005303-9hp3atl",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20210812005303-9hp3atl",
				"updated": "20210812005306"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "代码示例"
				}
			]
		},
		{
			"ID": "20210810220146-ubtl8vd",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210810220146-ubtl8vd",
				"updated": "20210810220146"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YQ=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "@Slf4j(topic = \"TestBiasedLock\")\npublic class TestBiasedLock {\n\n    public static void main(String[] args) throws InterruptedException {\n        test2();\n    }\n\n    private static void test2() {\n        Dog d = new Dog();\n        ClassLayout classLayout = ClassLayout.parseInstance(d);\n        new Thread(() -\u003e {\n            log.debug(\"synchronized 加锁前\\n{}\", classLayout.toPrintable());\n            synchronized (d) {\n                log.debug(\"synchronized 加锁中\\n{}\", classLayout.toPrintable());\n            }\n            log.debug(\"synchronized 加锁后\\n{}\",classLayout.toPrintable());\n        }, \"t1\").start();\n    }\n}\n\nclass Dog {\n\n}\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210810220146-gukelnx",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210810220146-gukelnx",
				"updated": "20210810220146"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "结果如下（"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "小端法"
				},
				{
					"Type": "NodeText",
					"Data": "）："
				}
			]
		},
		{
			"ID": "20210810220146-gv50s39",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210810220146-gv50s39",
				"updated": "20210810220146"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "cGxhaW50ZXh0"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "23:52:10.531 [t1] DEBUG TestBiasedLock - synchronized 加锁前\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000005 (biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n23:52:10.537 [t1] DEBUG TestBiasedLock - synchronized 加锁中\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fe007228005 (biased: 0x0000001ff801c8a0; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n23:52:10.538 [t1] DEBUG TestBiasedLock - synchronized 加锁后\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fe007228005 (biased: 0x0000001ff801c8a0; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210810220146-iqr687k",
			"Type": "NodeBlockQueryEmbed",
			"Properties": {
				"id": "20210810220146-iqr687k",
				"updated": "20210810220146"
			},
			"Children": [
				{
					"Type": "NodeOpenBrace"
				},
				{
					"Type": "NodeOpenBrace"
				},
				{
					"Type": "NodeBlockQueryEmbedScript",
					"Data": "select * from blocks where id='20210803235857-o26l1q4'"
				},
				{
					"Type": "NodeCloseBrace"
				},
				{
					"Type": "NodeCloseBrace"
				}
			]
		},
		{
			"ID": "20210810215952-9oz8tnh",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210810215952-9oz8tnh",
				"updated": "20210810215952"
			}
		},
		{
			"ID": "20210811224957-xv8joih",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210811224957-xv8joih",
				"updated": "20210811224957"
			}
		},
		{
			"ID": "20210811224916-w2hj376",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210811224916-w2hj376",
				"updated": "20210811224916"
			}
		},
		{
			"ID": "20210811224916-1f38pvz",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210811224916-1f38pvz",
				"updated": "20210811224916"
			}
		},
		{
			"ID": "20210810220122-483pqpl",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20210810220122-483pqpl",
				"updated": "20210811225709"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "解锁（释放锁） 🔥"
				}
			]
		},
		{
			"ID": "20210810220135-iy9cnif",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210810220135-iy9cnif",
				"updated": "20210810220135"
			}
		},
		{
			"ID": "20210810220122-10mdwa6",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210810220122-10mdwa6",
				"updated": "20210810220122"
			}
		},
		{
			"ID": "20210801163043-0cyqw5c",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210801163043-0cyqw5c",
				"updated": "20210801163043"
			}
		},
		{
			"ID": "20210801163043-ypitcel",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20210801163043-ypitcel",
				"updated": "20210805215648"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "revoke 撤销偏向锁 🔥"
				}
			]
		},
		{
			"ID": "20210804010752-3p0juyx",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210804010752-3p0juyx",
				"updated": "20210804010855"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "注意：释放和撤销的区别，"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "释放是退出同步块"
				},
				{
					"Type": "NodeText",
					"Data": "（即同步块内代码执行完毕），"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "撤销指线程竞争导致需要锁升级"
				}
			]
		},
		{
			"ID": "20210804010752-1ffjps1",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210804010752-1ffjps1",
				"updated": "20210804010752"
			}
		},
		{
			"ID": "20210707224540-29k1dj4",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20210707224540-29k1dj4",
				"updated": "20210801163051"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "锁对象调用未重写的 hashCode"
				}
			]
		},
		{
			"ID": "20210707224540-mrg1zm0",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-mrg1zm0",
				"updated": "20210801172700"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "调用了对象"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "未重写"
				},
				{
					"Type": "NodeText",
					"Data": "的 hashCode（未重写，则调用的是Object的），由于"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "偏向锁的对象 MarkWord 中存储的是线程 id"
				},
				{
					"Type": "NodeText",
					"Data": "，如果调用 hashCode 会导致偏向锁被撤销（不够存线程 ID），"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "升级为重量级量锁"
				}
			]
		},
		{
			"ID": "20210707224540-9tv0upf",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20210707224540-9tv0upf",
				"updated": "20210707224540"
			},
			"Children": [
				{
					"ID": "20210707224540-aaer7fi",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210707224540-aaer7fi"
					},
					"Children": [
						{
							"ID": "20210707224540-5oflhmb",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210707224540-5oflhmb"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "轻量级锁的 hashCode 会在无锁 CAS 转为轻量锁时记录到锁记录中"
								}
							]
						}
					]
				},
				{
					"ID": "20210707224540-q6v483d",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210707224540-q6v483d"
					},
					"Children": [
						{
							"ID": "20210707224540-xim80hh",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210707224540-xim80hh"
							},
							"Children": [
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "重量级锁会在 Monitor 中记录 hashCode"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20210707224540-juo13sy",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-juo13sy",
				"updated": "20210707224540"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "测试在调用 hashCode 后使用偏向锁，记得去掉 "
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "-XX:-UseBiasedLocking"
				},
				{
					"Type": "NodeText",
					"Data": "，加上"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "-XX:BiasedLockingStartupDelay=0"
				}
			]
		},
		{
			"ID": "20210707224540-gfht836",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210707224540-gfht836",
				"updated": "20210707224540"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YQ=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "@Slf4j(topic = \"TestBiasedLock\")\npublic class TestBiasedLock {\n\n    public static void main(String[] args) throws InterruptedException {\n        test2();\n    }\n\n    private static void test2() {\n        Dog d = new Dog();\n        d.hashCode();\n        ClassLayout classLayout = ClassLayout.parseInstance(d);\n        new Thread(() -\u003e {\n            log.debug(\"synchronized 加锁前\\n{}\", classLayout.toPrintable());\n            synchronized (d) {\n                log.debug(\"synchronized 加锁中\\n{}\", classLayout.toPrintable());\n            }\n            log.debug(\"synchronized 加锁后\\n{}\",classLayout.toPrintable());\n        }, \"t1\").start();\n    }\n}\n\nclass Dog {\n\n}\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210707224540-18bwgon",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-18bwgon",
				"updated": "20210728003913"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "结果如下（"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "小端法"
				},
				{
					"Type": "NodeText",
					"Data": "）："
				}
			]
		},
		{
			"ID": "20210707224540-i2pq7yt",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210707224540-i2pq7yt",
				"updated": "20210804000333"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "00:01:59.516 [t1] DEBUG TestBiasedLock - synchronized 加锁前\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00000020ad941801 (hash: 0x20ad9418; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:01:59.522 [t1] DEBUG TestBiasedLock - synchronized 加锁中\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000700001f96900 (thin lock: 0x0000700001f96900)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:01:59.523 [t1] DEBUG TestBiasedLock - synchronized 加锁后\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00000020ad941801 (hash: 0x20ad9418; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210707224540-0kjtgps",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-0kjtgps",
				"updated": "20210804002225"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "加锁前后都是"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "0x1"
				},
				{
					"Type": "NodeText",
					"Data": "即无锁，加锁中为"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "code",
					"TextMarkTextContent": "0x0"
				},
				{
					"Type": "NodeText",
					"Data": "轻量锁"
				}
			]
		},
		{
			"ID": "20210804002226-5vheu6p",
			"Type": "NodeBlockQueryEmbed",
			"Properties": {
				"id": "20210804002226-5vheu6p",
				"updated": "20210804002226"
			},
			"Children": [
				{
					"Type": "NodeOpenBrace"
				},
				{
					"Type": "NodeOpenBrace"
				},
				{
					"Type": "NodeBlockQueryEmbedScript",
					"Data": "select * from blocks where id='20210804001923-h33tl8f'"
				},
				{
					"Type": "NodeCloseBrace"
				},
				{
					"Type": "NodeCloseBrace"
				}
			]
		},
		{
			"ID": "20210728001958-8mz2esr",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210728001958-8mz2esr",
				"updated": "20210728001958"
			}
		},
		{
			"ID": "20210707224540-504ooo0",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20210707224540-504ooo0",
				"updated": "20210801163057"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "锁竞争—其他线程使用锁 🔥"
				}
			]
		},
		{
			"ID": "20210707224540-hl44l72",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-hl44l72",
				"updated": "20210804000351"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "当有"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "其它线程使用偏向锁对象"
				},
				{
					"Type": "NodeText",
					"Data": "时，会"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "将偏向锁升级为轻量级锁"
				},
				{
					"Type": "NodeText",
					"Data": "。因为偏向锁本来是让该线程一直使用的，但是发生竞争，需"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "升级为轻量锁"
				},
				{
					"Type": "NodeText",
					"Data": "。记住"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "先关闭延迟"
				}
			]
		},
		{
			"ID": "20210707224540-l7obmjd",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210707224540-l7obmjd",
				"updated": "20210804000506"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YQ=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "@Slf4j(topic = \"TestBiasedLock\")\npublic class TestBiasedLock {\n\n    public static void main(String[] args) {\n        test3();\n    }\n\n    /**\n     * 其他线程使用对象 撤销偏向锁\n     */\n    private static void test3() {\n        Dog d = new Dog();\n        ClassLayout classLayout = ClassLayout.parseInstance(d);\n        Thread t1 = new Thread(() -\u003e {\n            log.debug(\"t1 synchronized 加锁前\\n{}\", classLayout.toPrintable());\n            synchronized (d) {\n                log.debug(\"t1 synchronized 加锁中\\n{}\", classLayout.toPrintable());\n            }\n            log.debug(\"t1 synchronized 加锁后\\n{}\", classLayout.toPrintable());\n\n            // 这里和 wait、notify 撤销偏向锁不一样哦，因为锁对象都不一样！\n            // 结果是要让t1先执行哦，所以使用 wait、notify\n            // t1 执行完再唤醒 t2（用同一把锁）。此时wait、notify使用的TestBiasedLock是重量锁，但与本实验的d锁无关\n            synchronized (TestBiasedLock.class) {\n                TestBiasedLock.class.notify();\n            }\n\n        }, \"t1\");\n        t1.start();\n\n\n        Thread t2 = new Thread(() -\u003e {\n            // 这里和 wait、notify 撤销偏向锁不一样哦，因为锁对象都不一样！\n            // 结果是要让t1先执行哦，所以使用 wait、notify\n            // 等待唤醒\n            synchronized (TestBiasedLock.class) {\n                try {\n                    TestBiasedLock.class.wait();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n\n            log.debug(\"t2 synchronized 加锁前\\n{}\", classLayout.toPrintable());\n            synchronized (d) {\n                log.debug(\"t2 synchronized 加锁中\\n{}\", classLayout.toPrintable());\n            }\n            log.debug(\"t2 synchronized 加锁后\\n{}\", classLayout.toPrintable());\n        }, \"t2\");\n        t2.start();\n    }\n}\n\nclass Dog {\n\n}\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210707224540-5j66aku",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-5j66aku",
				"updated": "20210728003908"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "结果如下（"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "小端法"
				},
				{
					"Type": "NodeText",
					"Data": "）："
				}
			]
		},
		{
			"ID": "20210729002140-zjsflke",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210729002140-zjsflke",
				"updated": "20210804000610"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "cGxhaW50ZXh0"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "00:05:17.090 [t1] DEBUG TestBiasedLock - t1 synchronized 加锁前\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000005 (biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:05:17.095 [t1] DEBUG TestBiasedLock - t1 synchronized 加锁中\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fa475155005 (biased: 0x0000001fe91d4554; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:05:17.095 [t1] DEBUG TestBiasedLock - t1 synchronized 加锁后\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fa475155005 (biased: 0x0000001fe91d4554; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:05:17.096 [t2] DEBUG TestBiasedLock - t2 synchronized 加锁前\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fa475155005 (biased: 0x0000001fe91d4554; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:05:17.097 [t2] DEBUG TestBiasedLock - t2 synchronized 加锁中\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x000070000d8128f0 (thin lock: 0x000070000d8128f0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:05:17.098 [t2] DEBUG TestBiasedLock - t2 synchronized 加锁后\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210707224540-rovc6id",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-rovc6id",
				"updated": "20210804002217"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "由上面状态 0x5、0x5、0x5、0x5、0x0、0x1 改变可以得出 t1 线程都是偏向锁，t2 线程加锁前、中、后分别为偏向锁、轻量锁（竞争导致锁升级）、无锁。"
				}
			]
		},
		{
			"ID": "20210804002218-9yx0hvx",
			"Type": "NodeBlockQueryEmbed",
			"Properties": {
				"id": "20210804002218-9yx0hvx",
				"updated": "20210804002218"
			},
			"Children": [
				{
					"Type": "NodeOpenBrace"
				},
				{
					"Type": "NodeOpenBrace"
				},
				{
					"Type": "NodeBlockQueryEmbedScript",
					"Data": "select * from blocks where id='20210804001923-h33tl8f'"
				},
				{
					"Type": "NodeCloseBrace"
				},
				{
					"Type": "NodeCloseBrace"
				}
			]
		},
		{
			"ID": "20210728002006-lmrbmfj",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210728002006-lmrbmfj",
				"updated": "20210728002006"
			}
		},
		{
			"ID": "20210707224540-t54wz43",
			"Type": "NodeHeading",
			"HeadingLevel": 3,
			"Properties": {
				"id": "20210707224540-t54wz43",
				"updated": "20210801163103"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "锁对象调用 wait/notify"
				}
			]
		},
		{
			"ID": "20210707224540-etg9gnw",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-etg9gnw",
				"updated": "20210707224540"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "wait/notify 机制只有重量级锁才有！只要调用了就变为重量级锁"
				}
			]
		},
		{
			"ID": "20210707224540-pa4ydl5",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210707224540-pa4ydl5",
				"updated": "20210804001458"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YQ=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "@Slf4j(topic = \"TestBiasedLock\")\npublic class TestBiasedLock {\n\n    public static void main(String[] args) {\n        test4();\n    }\n\n    /**\n     * 撤销偏向锁—锁对象调用 wait/notify\n     */\n    private static void test4() {\n        Dog d = new Dog();\n        ClassLayout classLayout = ClassLayout.parseInstance(d);\n\n        // 结果是要让t1先执行哦\n        Thread t1 = new Thread(() -\u003e {\n            log.debug(\"t1 synchronized 加锁前\\n{}\", classLayout.toPrintable());\n            synchronized (d) {\n                log.debug(\"t1 synchronized 加锁中\\n{}\", classLayout.toPrintable());\n                try {\n                    // 等待\n                    d.wait();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                log.debug(\"t1 synchronized notify 后\\n{}\", classLayout.toPrintable());\n            }\n            log.debug(\"t1 synchronized 加锁后\\n{}\", classLayout.toPrintable());\n        }, \"t1\");\n        t1.start();\n\n\n        Thread t2 = new Thread(() -\u003e {\n            // 这里sleep只是为了让t1的wait先执行\n            try {\n                TimeUnit.SECONDS.sleep(5);\n                log.debug(\"t2 睡了5秒\");\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n\n            synchronized (d) {\n                log.debug(\"t2 notify\");\n                d.notify();\n            }\n\n        }, \"t2\");\n        t2.start();\n\n\n        try {\n            TimeUnit.SECONDS.sleep(10);\n            log.debug(\"=============最后\\n{}\", classLayout.toPrintable());\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\nclass Dog {\n\n}\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210707224540-tb9u6q2",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-tb9u6q2",
				"updated": "20210728003850"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "结果如下（"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "小端法"
				},
				{
					"Type": "NodeText",
					"Data": "）："
				}
			]
		},
		{
			"ID": "20210707224540-f552sv9",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210707224540-f552sv9",
				"updated": "20210804001509"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "00:14:26.080 [t1] DEBUG TestBiasedLock - t1 synchronized 加锁前\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000005 (biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:14:26.085 [t1] DEBUG TestBiasedLock - t1 synchronized 加锁中\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fd941077805 (biased: 0x0000001ff65041de; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:14:31.079 [t2] DEBUG TestBiasedLock - t2 睡了5秒\n00:14:31.080 [t2] DEBUG TestBiasedLock - t2 notify\n00:14:31.081 [t1] DEBUG TestBiasedLock - t1 synchronized notify 后\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fd93e83cf3a (fat lock: 0x00007fd93e83cf3a)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:14:31.082 [t1] DEBUG TestBiasedLock - t1 synchronized 加锁后\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fd93e83cf3a (fat lock: 0x00007fd93e83cf3a)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:14:36.080 [main] DEBUG TestBiasedLock - =============最后\n_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210707224540-4mk9hl7",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-4mk9hl7",
				"updated": "20210804001759"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "上面的状态：加锁前 0x5 偏向锁、加锁中 0x5 偏向锁、nofity 后 0xa 重量级锁（锁膨胀）、加锁后 0xa 重量级锁、最后sleep 5秒后变为 0x1（无锁）。"
				}
			]
		},
		{
			"ID": "20210804002205-h8spia0",
			"Type": "NodeBlockQueryEmbed",
			"Properties": {
				"id": "20210804002205-h8spia0",
				"updated": "20210804002205"
			},
			"Children": [
				{
					"Type": "NodeOpenBrace"
				},
				{
					"Type": "NodeOpenBrace"
				},
				{
					"Type": "NodeBlockQueryEmbedScript",
					"Data": "select * from blocks where id='20210804001923-h33tl8f'"
				},
				{
					"Type": "NodeCloseBrace"
				},
				{
					"Type": "NodeCloseBrace"
				}
			]
		},
		{
			"ID": "20210804001656-emxf67l",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210804001656-emxf67l",
				"updated": "20210804001757"
			}
		},
		{
			"ID": "20210802235052-oqhz3mc",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210802235052-oqhz3mc",
				"updated": "20210802235052"
			}
		},
		{
			"ID": "20210707224540-2ukrk2n",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20210707224540-2ukrk2n",
				"updated": "20210805222334"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "bulk rebiase 批量重偏向—同一类的对象撤销后第 20 次"
				}
			]
		},
		{
			"ID": "20210803000245-11j8s8w",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210803000245-11j8s8w",
				"updated": "20210804005851"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "批量重偏向和批量撤销是"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "针对类的优化"
				},
				{
					"Type": "NodeText",
					"Data": "，和对象无关，都是"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "撤销"
				},
				{
					"Type": "NodeText",
					"Data": "操作阈值（"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "类的全局计数"
				},
				{
					"Type": "NodeText",
					"Data": "）"
				}
			]
		},
		{
			"ID": "20210707224540-es3o8f9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-es3o8f9",
				"updated": "20210707224540"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "如果对象虽然被多个线程访问，但没有竞争，这时偏向了线程 T1 的对象仍有机会重新偏向 T2，"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "重偏向会重置对象的 Thread ID"
				},
				{
					"Type": "NodeText",
					"Data": "。当"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "撤销偏向锁阈值超过 20 次"
				},
				{
					"Type": "NodeText",
					"Data": "后，jvm 会这样觉得，我是不是偏向错了呢，于是会在给这些对象加锁时"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "不会撤销锁而是重新偏向至加锁线程"
				},
				{
					"Type": "NodeText",
					"Data": "。"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "没超过阈值前，由于锁竞争会升级为轻量级锁，最终执行完后清空 Thread ID，并将锁状态置为"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong code",
					"TextMarkTextContent": "001"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "即无锁状态"
				}
			]
		},
		{
			"ID": "20210803000229-mkpy2ld",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210803000229-mkpy2ld",
				"updated": "20210804160946"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "偏向锁重偏向一次之后不可再次重偏向"
				},
				{
					"Type": "NodeText",
					"Data": "，因为再撤销20次，就会触发批量撤销！！！"
				}
			]
		},
		{
			"ID": "20210707224540-28qf40i",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210707224540-28qf40i",
				"updated": "20210804005809"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YQ=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "@Slf4j(topic = \"TestBiasedLock\")\npublic class TestBiasedLock {\n\n    public static void main(String[] args) {\n        test5();\n    }\n\n    /**\n     * 批量重偏向\n     */\n    private static void test5() {\n        Vector\u003cDog\u003e list = new Vector\u003c\u003e();\n        Thread t1 = new Thread(() -\u003e {\n            for (int i = 0; i \u003c 30; i++) {\n                Dog d = new Dog();\n                list.add(d);\n                synchronized (d) {\n                    log.debug(\"t1线程第{}个锁对象加偏向锁:\\t{}\", i+1, ClassLayout.parseInstance(d).toPrintable());\n                }\n            }\n\n            // 只是为了保证t1先执行\n            synchronized (list) {\n                list.notify();\n            }\n\t    // 如果不用 wait/notify 使用 join 必须打开下面的注释\n            // 因为：t1 线程不能结束，否则底层线程可能被 jvm 重用作为 t2 线程，导致底层线程 id 是一样的\n            // try {\n            //     System.in.read();\n            // } catch (IOException e) {\n            //     e.printStackTrace();\n            // }\n        }, \"t1\");\n        t1.start();\n\n        Thread t2 = new Thread(() -\u003e {\n            // 只是为了保证t1先执行\n            synchronized (list) {\n                try {\n                    list.wait();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n            for (int i = 0; i \u003c 30; i++) {\n                Dog d = list.get(i);\n                log.debug(\"t2线程第{}个锁对象 sync 前：\\t{}\", i+1, ClassLayout.parseInstance(d).toPrintable());\n                synchronized (d) {\n                    log.debug(\"t2线程第{}个锁对象 sync 中：\\t{}\", i+1, ClassLayout.parseInstance(d).toPrintable());\n                }\n                log.debug(\"t2线程第{}个锁对象 sync 后：\\t{}\", i+1, ClassLayout.parseInstance(d).toPrintable());\n            }\n\n            // 前面19个锁对象已经撤销为轻量级锁，最终变为无锁状态，偏向锁状态已经为0了，所以批量重偏向时不会对它们进行\n            for (int i = 0; i \u003c 19; i++) {\n                Dog d = list.get(i);\n                log.debug(\"===最终第{}个锁对象状态：\\t{}\", i+1, ClassLayout.parseInstance(d).toPrintable());\n            }\n\n        }, \"t2\");\n        t2.start();\n    }\n}\n\nclass Dog {\n\n}\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210707224540-wohln2q",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-wohln2q",
				"updated": "20210707224540"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "结果如下（老师简化后的工具类）"
				}
			]
		},
		{
			"ID": "20210804003542-j64mrug",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"fold": "1",
				"id": "20210804003542-j64mrug",
				"updated": "20210804005128"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "cGxhaW50ZXh0"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "00:32:43.680 [t1] DEBUG TestBiasedLock - t1线程第1个加偏向锁:\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007f9e79193805 (biased: 0x0000001fe79e464e; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n............ \n00:32:43.695 [t1] DEBUG TestBiasedLock - t1线程第30个加偏向锁:\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007f9e79193805 (biased: 0x0000001fe79e464e; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n\n\n00:32:43.695 [t2] DEBUG TestBiasedLock - t2线程第1个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007f9e79193805 (biased: 0x0000001fe79e464e; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:32:43.695 [t2] DEBUG TestBiasedLock - t2线程第1个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x000070000ee678f8 (thin lock: 0x000070000ee678f8)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:32:43.696 [t2] DEBUG TestBiasedLock - t2线程第1个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n............\n00:32:43.709 [t2] DEBUG TestBiasedLock - t2线程第19个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007f9e79193805 (biased: 0x0000001fe79e464e; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:32:43.709 [t2] DEBUG TestBiasedLock - t2线程第19个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x000070000ee678f8 (thin lock: 0x000070000ee678f8)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:32:43.709 [t2] DEBUG TestBiasedLock - t2线程第19个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n\n\n00:32:43.709 [t2] DEBUG TestBiasedLock - t2线程第20个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007f9e79193805 (biased: 0x0000001fe79e464e; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:32:43.709 [t2] DEBUG TestBiasedLock - t2线程第20个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007f9e78099105 (biased: 0x0000001fe79e0264; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:32:43.710 [t2] DEBUG TestBiasedLock - t2线程第20个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007f9e78099105 (biased: 0x0000001fe79e0264; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n............\n00:32:43.714 [t2] DEBUG TestBiasedLock - t2线程第30个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007f9e79193805 (biased: 0x0000001fe79e464e; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:32:43.714 [t2] DEBUG TestBiasedLock - t2线程第30个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007f9e78099105 (biased: 0x0000001fe79e0264; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n00:32:43.714 [t2] DEBUG TestBiasedLock - t2线程第30个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007f9e78099105 (biased: 0x0000001fe79e0264; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800f1c6\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n\n\n00:46:50.025 [t2] DEBUG TestBiasedLock - ===最终第1个锁对象状态：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n............\n00:46:50.025 [t2] DEBUG TestBiasedLock - ===最终第19个锁对象状态：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210804003628-r4vt3ha",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20210804003628-r4vt3ha",
				"updated": "20210804003921"
			},
			"Children": [
				{
					"ID": "20210804003633-6ix9dwg",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210804003633-6ix9dwg",
						"updated": "20210804003921"
					},
					"Children": [
						{
							"ID": "20210804003633-a5pcf6a",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210804003633-a5pcf6a",
								"updated": "20210804003921"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "t1中 1~30个锁对象"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "加偏向锁"
								},
								{
									"Type": "NodeText",
									"Data": "都是一样的"
								}
							]
						}
					]
				},
				{
					"ID": "20210804003652-ibaj65d",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210804003652-ibaj65d"
					},
					"Children": [
						{
							"ID": "20210804003652-vwbgugd",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210804003652-vwbgugd",
								"updated": "20210804003918"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "t2中1~19个锁对象都是在进行"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "偏向锁撤销"
								},
								{
									"Type": "NodeText",
									"Data": "，经历"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "偏向锁-\u0026gt;轻量级锁-\u0026gt;无锁"
								}
							]
						}
					]
				},
				{
					"ID": "20210804003922-k7p4b6l",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210804003922-k7p4b6l",
						"updated": "20210804005254"
					},
					"Children": [
						{
							"ID": "20210804003922-a56v1rk",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210804003922-a56v1rk",
								"updated": "20210804005254"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "t2中从第20锁对象开始，进行"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "批量重偏向"
								},
								{
									"Type": "NodeText",
									"Data": "，第20~30个锁对象批量重偏向前偏向状态都是1，所以最后都是"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "偏向了t2线程的偏向锁"
								},
								{
									"Type": "NodeText",
									"Data": "；而第师~"
								},
								{
									"Type": "NodeText",
									"Data": "傅师傅"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20210804005402-byrysi9",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210804005402-byrysi9",
				"updated": "20210804005402"
			}
		},
		{
			"ID": "20210707224540-3jn2hib",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-3jn2hib",
				"updated": "20210707224540"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "\n"
				}
			]
		},
		{
			"ID": "20210707224540-dmn9rwe",
			"Type": "NodeHeading",
			"HeadingLevel": 2,
			"Properties": {
				"id": "20210707224540-dmn9rwe",
				"updated": "20210805215730"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "bulk revoke 批量撤销—同一类对象撤销后第 40 次"
				}
			]
		},
		{
			"ID": "20210803000251-7o9os2f",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210803000251-7o9os2f",
				"updated": "20210803000429"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "批量重偏向和批量撤销是"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "针对类的优化"
				},
				{
					"Type": "NodeText",
					"Data": "，和对象无关。在多线程竞争剧烈的情况下，使用偏向锁将会降低效率，于是乎产生了批量撤销机制。"
				}
			]
		},
		{
			"ID": "20210707224540-n0j9vnh",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-n0j9vnh",
				"updated": "20210804180734"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "都是"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "撤销"
				},
				{
					"Type": "NodeText",
					"Data": "操作阈值（"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "类的全局计数"
				},
				{
					"Type": "NodeText",
					"Data": "）。同一类的可能有"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "多个实例锁对象"
				},
				{
					"Type": "NodeText",
					"Data": "。"
				}
			]
		},
		{
			"ID": "20210707224540-zb6rumd",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-zb6rumd",
				"updated": "20210804213816"
			},
			"Children": [
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "当撤销偏向锁阈值超过 40 次后"
				},
				{
					"Type": "NodeText",
					"Data": "，jvm 会这样觉得，自己确实偏向错了，根本就不该偏向。于是"
				},
				{
					"Type": "NodeTextMark",
					"TextMarkType": "strong",
					"TextMarkTextContent": "将class中的偏向状态修改为0"
				},
				{
					"Type": "NodeText",
					"Data": "，整个类的所有对象在每次获取锁、释放锁时都会变为不可偏向的，新建的对象也是不可偏向的"
				}
			]
		},
		{
			"ID": "20210707224540-xo5ym3x",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"id": "20210707224540-xo5ym3x",
				"updated": "20210804180716"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "amF2YQ=="
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "@Slf4j(topic = \"TestBiasedLock\")\npublic class TestBiasedLock {\n\n    public static void main(String[] args) throws InterruptedException {\n        test6();\n    }\n\n    static Thread t1, t2, t3;\n\n    /**\n     * 批量撤销\n     */\n    private static void test6() throws InterruptedException {\n\n        Vector\u003cDog\u003e list = new Vector\u003c\u003e();\n        int loopNumber = 40;\n        t1 = new Thread(() -\u003e {\n            for (int i = 0; i \u003c loopNumber; i++) {\n                Dog d = new Dog();\n                list.add(d);\n                synchronized (d) {\n                    log.debug(\"t1线程第{}个锁对象加偏向锁:\\t{}\", i+1, ClassLayout.parseInstance(d).toPrintable());\n                }\n            }\n            LockSupport.unpark(t2);\n        }, \"t1\");\n        t1.start();\n\n        t2 = new Thread(() -\u003e {\n            LockSupport.park();\n            for (int i = 0; i \u003c loopNumber; i++) {\n                Dog d = list.get(i);\n                log.debug(\"t2线程第{}个锁对象 sync 前：\\t{}\", i+1, ClassLayout.parseInstance(d).toPrintable());\n                synchronized (d) {\n                    log.debug(\"t2线程第{}个锁对象 sync 中：\\t{}\", i+1, ClassLayout.parseInstance(d).toPrintable());\n                }\n                log.debug(\"t2线程第{}个锁对象 sync 后：\\t{}\", i+1, ClassLayout.parseInstance(d).toPrintable());\n            }\n            LockSupport.unpark(t3);\n        }, \"t2\");\n        t2.start();\n\n        t3 = new Thread(() -\u003e {\n            LockSupport.park();\n            for (int i = 0; i \u003c loopNumber; i++) {\n                Dog d = list.get(i);\n                log.debug(\"t3线程第{}个锁对象 sync 前：\\t{}\", i+1, ClassLayout.parseInstance(d).toPrintable());\n                synchronized (d) {\n                    log.debug(\"t3线程第{}个锁对象 sync 中：\\t{}\", i+1, ClassLayout.parseInstance(d).toPrintable());\n                }\n                log.debug(\"t3线程第{}个锁对象 sync 后：\\t{}\", i+1, ClassLayout.parseInstance(d).toPrintable());\n            }\n        }, \"t3\");\n        t3.start();\n\n        t3.join();\n        log.debug(ClassLayout.parseInstance(new Dog()).toPrintable());\n\n    }\n}\n\nclass Dog {\n\n}\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210707224540-3gzk0h6",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210707224540-3gzk0h6",
				"updated": "20210804161342"
			},
			"Children": [
				{
					"Type": "NodeText",
					"Data": "结果如下："
				}
			]
		},
		{
			"ID": "20210804161342-mq6j0pm",
			"Type": "NodeCodeBlock",
			"IsFencedCodeBlock": true,
			"Properties": {
				"fold": "1",
				"id": "20210804161342-mq6j0pm",
				"updated": "20210804180409"
			},
			"Children": [
				{
					"Type": "NodeCodeBlockFenceOpenMarker",
					"Data": "```"
				},
				{
					"Type": "NodeCodeBlockFenceInfoMarker",
					"CodeBlockInfo": "cGxhaW50ZXh0"
				},
				{
					"Type": "NodeCodeBlockCode",
					"Data": "16:23:46.667 [t1] DEBUG TestBiasedLock - t1线程第1个锁对象加偏向锁:\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07882805 (biased: 0x0000001ffa81e20a; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n............\n16:23:46.667 [t1] DEBUG TestBiasedLock - t1线程第40个锁对象加偏向锁: _999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07882805 (biased: 0x0000001ffa81e20a; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n\n\n16:23:46.685 [t2] DEBUG TestBiasedLock - t2线程第1个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07882805 (biased: 0x0000001ffa81e20a; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.685 [t2] DEBUG TestBiasedLock - t2线程第1个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007000026c38f0 (thin lock: 0x00007000026c38f0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.686 [t2] DEBUG TestBiasedLock - t2线程第1个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n............\n16:23:46.698 [t2] DEBUG TestBiasedLock - t2线程第19个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07882805 (biased: 0x0000001ffa81e20a; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.698 [t2] DEBUG TestBiasedLock - t2线程第19个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007000026c38f0 (thin lock: 0x00007000026c38f0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.698 [t2] DEBUG TestBiasedLock - t2线程第19个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n\n\n16:23:46.698 [t2] DEBUG TestBiasedLock - t2线程第20个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07882805 (biased: 0x0000001ffa81e20a; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.699 [t2] DEBUG TestBiasedLock - t2线程第20个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07887105 (biased: 0x0000001ffa81e21c; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.699 [t2] DEBUG TestBiasedLock - t2线程第20个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07887105 (biased: 0x0000001ffa81e21c; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n............\n16:23:46.706 [t2] DEBUG TestBiasedLock - t2线程第40个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07882805 (biased: 0x0000001ffa81e20a; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.706 [t2] DEBUG TestBiasedLock - t2线程第40个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07887105 (biased: 0x0000001ffa81e21c; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.707 [t2] DEBUG TestBiasedLock - t2线程第40个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07887105 (biased: 0x0000001ffa81e21c; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n\n\n16:23:46.707 [t3] DEBUG TestBiasedLock - t3线程第1个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.707 [t3] DEBUG TestBiasedLock - t3线程第1个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007000027c68f0 (thin lock: 0x00007000027c68f0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.707 [t3] DEBUG TestBiasedLock - t3线程第1个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n............\n16:23:46.714 [t3] DEBUG TestBiasedLock - t3线程第19个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.714 [t3] DEBUG TestBiasedLock - t3线程第19个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007000027c68f0 (thin lock: 0x00007000027c68f0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.714 [t3] DEBUG TestBiasedLock - t3线程第19个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n\n\n16:23:46.714 [t3] DEBUG TestBiasedLock - t3线程第20个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07887105 (biased: 0x0000001ffa81e21c; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.715 [t3] DEBUG TestBiasedLock - t3线程第20个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007000027c68f0 (thin lock: 0x00007000027c68f0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.715 [t3] DEBUG TestBiasedLock - t3线程第20个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n............\n16:23:46.724 [t3] DEBUG TestBiasedLock - t3线程第39个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07887105 (biased: 0x0000001ffa81e21c; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.724 [t3] DEBUG TestBiasedLock - t3线程第39个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007000027c68f0 (thin lock: 0x00007000027c68f0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.724 [t3] DEBUG TestBiasedLock - t3线程第39个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.724 [t3] DEBUG TestBiasedLock - t3线程第40个锁对象 sync 前：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007fea07887105 (biased: 0x0000001ffa81e21c; epoch: 0; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.725 [t3] DEBUG TestBiasedLock - t3线程第40个锁对象 sync 中：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x00007000027c68f0 (thin lock: 0x00007000027c68f0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n16:23:46.725 [t3] DEBUG TestBiasedLock - t3线程第40个锁对象 sync 后：\t_999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n\n\n\n16:23:46.725 [main] DEBUG TestBiasedLock - _999_demo.Dog object internals:\nOFF  SZ   TYPE DESCRIPTION               VALUE\n  0   8        (object header: mark)     0x0000000000000001 (non-biasable; age: 0)\n  8   4        (object header: class)    0xf800ef22\n 12   4        (object alignment gap)  \nInstance size: 16 bytes\nSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total\n"
				},
				{
					"Type": "NodeCodeBlockFenceCloseMarker",
					"Data": "```"
				}
			]
		},
		{
			"ID": "20210804162539-9wazum2",
			"Type": "NodeList",
			"ListData": {},
			"Properties": {
				"id": "20210804162539-9wazum2",
				"updated": "20210804180646"
			},
			"Children": [
				{
					"ID": "20210804162739-1sb4496",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210804162739-1sb4496"
					},
					"Children": [
						{
							"ID": "20210804162739-oj1114a",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210804162739-oj1114a",
								"updated": "20210804162833"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "t1中 1~40个锁对象"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "加偏向锁"
								},
								{
									"Type": "NodeText",
									"Data": "都是一样的"
								}
							]
						}
					]
				},
				{
					"ID": "20210804162746-y79a0rk",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210804162746-y79a0rk"
					},
					"Children": [
						{
							"ID": "20210804162746-w50cbjj",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210804162746-w50cbjj",
								"updated": "20210804162747"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "t2中1~19个锁对象都是在进行"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "偏向锁撤销"
								},
								{
									"Type": "NodeText",
									"Data": "，经历"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "偏向锁-\u0026gt;轻量级锁-\u0026gt;无锁"
								}
							]
						}
					]
				},
				{
					"ID": "20210804162949-2xp80he",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210804162949-2xp80he",
						"updated": "20210804180617"
					},
					"Children": [
						{
							"ID": "20210804162949-hz6v9ee",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210804162949-hz6v9ee",
								"updated": "20210804180617"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "t2中第20个锁对象由于"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "锁对象撤销第20次及之后"
								},
								{
									"Type": "NodeText",
									"Data": "开始进行"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "批量重偏向"
								},
								{
									"Type": "NodeText",
									"Data": "，第20~40个锁对象批量重偏向前偏向状态都是1（epoch不同，此时为可偏向状态），所以最终第20~"
								},
								{
									"Type": "NodeText",
									"Data": "40个锁对象都是"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "偏向t2线程的偏向锁"
								}
							]
						}
					]
				},
				{
					"ID": "20210804162754-vdlz2od",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210804162754-vdlz2od"
					},
					"Children": [
						{
							"ID": "20210804162754-hw3pzv7",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210804162754-hw3pzv7",
								"updated": "20210804175751"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "t3中1~19个锁对象都是进行轻量级锁的加锁、释放锁操作，经历"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "无锁-\u0026gt;轻量级锁-\u0026gt;无锁"
								}
							]
						}
					]
				},
				{
					"ID": "20210804175755-pzwgesk",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210804175755-pzwgesk"
					},
					"Children": [
						{
							"ID": "20210804175755-jlmazcu",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210804175755-jlmazcu",
								"updated": "20210804180133"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "t3中20~40个锁对象由于锁竞争又进行"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "偏向锁撤销"
								},
								{
									"Type": "NodeText",
									"Data": "，经历"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "偏向锁-\u0026gt;轻量级锁-\u0026gt;无锁"
								}
							]
						}
					]
				},
				{
					"ID": "20210804180300-rh7nxev",
					"Type": "NodeListItem",
					"ListData": {
						"BulletChar": 42,
						"Marker": "Kg=="
					},
					"Properties": {
						"id": "20210804180300-rh7nxev",
						"updated": "20210804180646"
					},
					"Children": [
						{
							"ID": "20210804180300-fuau0p2",
							"Type": "NodeParagraph",
							"Properties": {
								"id": "20210804180300-fuau0p2",
								"updated": "20210804180646"
							},
							"Children": [
								{
									"Type": "NodeText",
									"Data": "由于此时该class的所有锁对象进行"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "撤销40次及之后"
								},
								{
									"Type": "NodeText",
									"Data": "，所以JVM进行"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "批量撤销"
								},
								{
									"Type": "NodeText",
									"Data": "，之后该class创建的"
								},
								{
									"Type": "NodeTextMark",
									"TextMarkType": "strong",
									"TextMarkTextContent": "对象都是不可偏向的"
								}
							]
						}
					]
				}
			]
		},
		{
			"ID": "20210804162537-u1o7l5l",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210804162537-u1o7l5l",
				"updated": "20210804162537"
			}
		},
		{
			"ID": "20210727005340-bp0w6z0",
			"Type": "NodeParagraph",
			"Properties": {
				"id": "20210727005340-bp0w6z0",
				"updated": "20210727005340"
			}
		}
	]
}